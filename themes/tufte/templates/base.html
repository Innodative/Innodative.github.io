<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ SITENAME }}{% endblock %}</title>
    <link rel="stylesheet" href="{{ SITEURL }}/theme/css/tufte.css">
    {% if FEED_ALL_ATOM %}
    <link href="{{ FEED_DOMAIN }}/{{ FEED_ALL_ATOM }}" type="application/atom+xml" rel="alternate" title="{{ SITENAME }} Atom Feed">
    {% endif %}
    <script src="{{ SITEURL }}/theme/js/theme-toggle.js"></script>
    
    <!-- MathJax for mathematical notation -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      startup: {
        pageReady: () => {
          return MathJax.startup.defaultPageReady().then(() => {
            // Ensure code blocks don't get processed
          });
        }
      }
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <header>
        <h1><a href="{{ SITEURL }}/">{{ SITENAME }}</a></h1>
        {% if SITESUBTITLE %}
        <p class="subtitle">{{ SITESUBTITLE }}</p>
        {% endif %}
        <nav>
            <ul>
                {% set page_order = ['Research', 'Teaching', 'Consulting', 'Media'] %}
                {% for page_title in page_order %}
                    {% for page in pages %}
                        {% if page.title == page_title %}
                        <li><a href="{{ SITEURL }}/{{ page.url }}">{{ page.title }}</a></li>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
                {% for topic_name, topic_slug in TOPICS %}
                <li><a href="{{ SITEURL }}/{{ topic_slug }}/">{{ topic_name }}</a></li>
                {% endfor %}
                {% set page_order_end = ['About', 'Colophon'] %}
                {% for page_title in page_order_end %}
                    {% for page in pages %}
                        {% if page.title == page_title %}
                        <li><a href="{{ SITEURL }}/{{ page.url }}">{{ page.title }}</a></li>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
                <li><button id="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button></li>
            </ul>
        </nav>
    </header>

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
        <p>&copy; {{ SITENAME }}. Built with <a href="https://getpelican.com/">Pelican</a> using a <a href="https://edwardtufte.github.io/tufte-css/">Tufte CSS</a> inspired theme.</p>
    </footer>
</body>
</html>
